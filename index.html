<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Onyx AI</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="styles.css" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#0a0a0a",
                        "panel-dark": "#141414",
                        "element-dark": "#1e1e1e",
                        "element-dark-hover": "#2a2a2a",
                        "text-dark-primary": "#e5e7eb",
                        "text-dark-secondary": "#9ca3af",
                    },
                    fontFamily: {
                        "display": ["ui-sans-serif", "system-ui", "Segoe UI", "Roboto", "Ubuntu", "Cantarell", "Noto Sans", "Helvetica Neue", "Arial", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                    boxShadow: {
                        'soft-lg': '0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.15)',
                    }
                },
            },
        }
    </script>
    <link rel="manifest" href="manifest.json"/>
</head>
<body class="bg-background-dark font-display text-text-dark-primary">
    <!-- Main Container -->
    <div class="relative flex h-screen w-full flex-row overflow-hidden">
        
        <!-- Collapsible Sidebar -->
        <aside id="sidebar" class="flex flex-col h-screen w-80 bg-gradient-to-b from-[#141414] to-[#0a0a0a] border-r border-white/5 shadow-soft-lg p-4 transition-all duration-300 ease-in-out">
            <div class="flex flex-col justify-between h-full">
                <!-- Top Section: Header & Navigation -->
                <div class="flex flex-col gap-8">
                    <div class="flex items-center gap-3 px-2">
                        <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="Onyx logo" style='background-image: url("onyxicon.jpg");'></div>
                        <div class="flex flex-col">
                            <h1 class="text-white text-base font-medium leading-normal">Onyx</h1>
                            <p class="text-text-dark-secondary text-sm font-normal leading-normal">AI Search</p>
                        </div>
                    </div>
                    
                    <nav class="flex flex-col gap-2">
                        <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/20" href="#">
                            <img src="chat-bubble.png" alt="Chat" class="h-5 w-5" />
                            <p class="text-primary text-sm font-bold leading-normal">Chat</p>
                        </a>
                    </nav>
                    
                    <!-- Search Parameters Section -->
                    <div class="flex flex-col">
                        <h3 class="text-white text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4">Search Parameters</h3>
                        <div class="flex flex-col gap-4 p-2 rounded-xl bg-element-dark">
                            <!-- Top K Slider -->
                            <div class="relative flex w-full flex-col items-start justify-between gap-3 p-2">
                                <div class="flex w-full items-center justify-between">
                                    <label class="text-white text-base font-medium leading-normal" for="top_k">מקסימום מסמכים \ פסקאות</label>
                                    <span id="top_k_value" class="text-text-dark-secondary text-sm font-normal leading-normal">5</span>
                                </div>
                                <div class="slider-container">
                                    <div class="slider-track">
                                        <div id="top_k_fill" class="slider-fill" style="width: 21.05%;"></div>
                                        <div class="slider-thumb" style="left: 21.05%;"></div>
                                    </div>
                                    <input type="range" id="top_k" min="1" max="20" value="5" class="slider-input">
                                </div>
                            </div>
                            
                            <!-- Score Threshold Slider -->
                            <div class="relative flex w-full flex-col items-start justify-between gap-3 p-2">
                                <div class="flex w-full items-center justify-between">
                                    <label class="text-white text-base font-medium leading-normal" for="score_threshold">סף התאמה מינימלי</label>
                                    <span id="score_threshold_value" class="text-text-dark-secondary text-sm font-normal leading-normal">0.50</span>
                                </div>
                                <div class="slider-container">
                                    <div class="slider-track">
                                        <div id="score_threshold_fill" class="slider-fill" style="width: 50%;"></div>
                                        <div class="slider-thumb" style="left: 50%;"></div>
                                    </div>
                                    <input type="range" id="score_threshold" min="0" max="1" step="0.05" value="0.5" class="slider-input">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bottom Section: Reset Button -->
                <div class="flex flex-col gap-2">
                    <div class="flex px-2 py-3 justify-center">
                        <button id="reset_params" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 flex-1 bg-element-dark-hover text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-element-dark transition-colors">
                            <span class="truncate">Reset</span>
                        </button>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col bg-[#141414] min-h-0">
            <!-- Header -->
            <header class="sticky top-0 z-20 w-full bg-[#141414]/80 backdrop-blur-sm shadow-[0_1px_0_0_rgba(255,255,255,0.08)]">
                <div class="mx-auto flex h-16 max-w-4xl items-center justify-between px-4 md:px-10 lg:px-0">
                    <div class="flex items-center gap-4">
                        <button id="sidebar_toggle" class="flex h-9 w-9 items-center justify-center rounded-lg bg-[#2a2a2a] text-white/80 transition-colors hover:bg-[#3a3a3a] lg:hidden">
                            <span class="material-symbols-outlined text-xl">menu</span>
                        </button>
                        <h1 class="text-lg font-semibold text-white">Onyx AI Chat Bot</h1>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="config_button" class="flex h-9 w-9 items-center justify-center rounded-lg bg-[#2a2a2a] text-white/80 transition-colors hover:bg-[#3a3a3a]">
                            <span class="sr-only">Config</span>
                            <img src="settings.png" alt="Settings" class="h-5 w-5"/>
                        </button>
                        <button id="help_button" class="flex h-9 w-9 items-center justify-center rounded-lg bg-[#2a2a2a] text-white/80 transition-colors hover:bg-[#3a3a3a]">
                            <span class="sr-only">Help</span>
                            <img src="help.png" alt="Help" class="h-5 w-5"/>
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Chat Interface -->
            <div class="flex flex-1 flex-col justify-end px-4 md:px-10 lg:px-20 min-h-0 overflow-hidden">
                <div id="chat_scroll" class="layout-content-container mx-auto flex w-full max-w-4xl flex-1 flex-col overflow-y-auto overscroll-contain pt-8 min-h-0">
                    <div id="chat_messages" class="flex flex-col gap-4 pb-4">
                        <!-- Welcome message -->
                        <div class="flex items-end gap-3 p-2">
                            <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full w-8 h-8 shrink-0 border border-white/10" data-alt="AI assistant avatar" style='background-image: url("agenticon.png");'></div>
                            <div class="flex flex-1 flex-col gap-1 items-start">
                                <p class="text-xs font-medium leading-normal text-white/50">Onyx AI Agent</p>
                                <div class="text-base font-normal leading-relaxed flex max-w-md rounded-xl rounded-bl-sm px-4 py-2.5 bg-[#1e1e1e] text-white">
                                    Hello! How can I help you with your documents today? Ask a question to get started.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Input Area -->
                <div class="sticky bottom-0 z-10 w-full bg-[#141414] pb-4 pt-2">
                    <div class="mx-auto max-w-4xl">
                        <div class="flex flex-col gap-3">
                            <!-- Search Mode Selector -->
                            <div class="flex gap-2 p-1 flex-wrap pl-2">
                                <button class="search-mode-btn active" data-mode="semantic">
                                    <p class="text-white text-sm font-medium leading-normal">חיפוש סמנטי</p>
                                </button>
                                <button class="search-mode-btn" data-mode="keyword">
                                    <p class="text-white/60 text-sm font-medium leading-normal">חיפוש לפי מילת מפתח</p>
                                </button>
                                <button class="search-mode-btn" data-mode="specific">
                                    <p class="text-white/60 text-sm font-medium leading-normal">חיפוש בפסקאות ספציפיות</p>
                                </button>
                            </div>
                            
                            <!-- Document IDs Input (hidden by default) -->
                            <div id="document_ids_container" class="hidden">
                                <input type="text" id="document_ids_input" placeholder="תכניס מזהים של פסקאות (פסקאות מופרדות בפסיקים)" class="w-full px-4 py-2 rounded-lg bg-[#2a2a2a] text-white placeholder:text-white/40 border border-transparent focus:border-primary/80 focus:shadow-[0_0_0_3px_rgba(19,127,236,0.3)] focus:outline-none">
                            </div>
                            
                            <!-- Main Input -->
                            <div class="flex w-full items-center gap-2 rounded-xl border border-transparent bg-[#2a2a2a] p-2 focus-within:border-primary/80 focus-within:shadow-[0_0_0_3px_rgba(19,127,236,0.3)]">
                                <label class="flex flex-1">
                                    <span class="sr-only">Type your question here</span>
                                    <input id="message_input" class="form-input w-full flex-1 resize-none overflow-hidden border-none bg-transparent px-2 text-base font-normal leading-normal text-white placeholder:text-white/40 focus:outline-none focus:ring-0" placeholder="הכנס כאן חיפוש" value=""/>
                                </label>
                                <button id="send_button" class="flex h-9 w-9 shrink-0 cursor-pointer items-center justify-center rounded-lg bg-primary text-white transition-transform duration-150 ease-in-out hover:scale-105 active:scale-95">
                                    <img src="send.png" alt="Send" class="h-5 w-5"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading_overlay" class="loading-overlay hidden">
        <div class="flex flex-col items-center justify-center gap-4 transform scale-95 opacity-0 animate-pop-in">
            <div class="w-12 h-12 border-2 border-white/20 border-t-white/80 rounded-full animate-spin-slow"></div>
            <p class="text-[#A1A1A6] text-sm font-medium">Processing...</p>
        </div>
    </div>
    
    <!-- Intro Popup -->
    <div id="intro_popup" class="popup-backdrop animate-fade-in">
        <div class="popup-content animate-scale-in" dir="rtl">
            <button id="close_intro" class="absolute top-4 right-4 text-[#888888] hover:text-white transition-colors">
                <img src="close.png" alt="Close" class="h-5 w-5" />
            </button>
            <div class="p-8 text-center">
                <div class="flex justify-center mb-4">
                    <div class="flex h-12 w-12 items-center justify-center rounded-full bg-[#2a2a2a]">
                        <img src="help.png" alt="Info" class="h-6 w-6"/>
                    </div>
                </div>
                <h1 class="text-white tracking-light text-[28px] font-bold leading-tight pb-2">מידע חשוב</h1>
                <div class="text-right text-base font-normal leading-relaxed text-white/80 space-y-3 pt-3">
                    <p>ברוכים הבאים! לפני שתתחילו, אנא שימו לב לנקודות הבאות:</p>
                    <ul class="list-disc list-inside space-y-2 pr-2">
                        <li>המערכת היא ניסיונית ועשויה להכיל מגבלות.</li>
                        <li>החיפוש מתבצע באופן סמנטי (מבוסס משמעות) ולא לפי מילות מפתח.</li>
                        <li>היסטוריית הצ'אט אינה נשמרת או משמשת להקשר.</li>
                        <li>התשובות הניתנות הן כלליות ומבוססות על מאגר המסמכים הקיים.</li>
                    </ul>
                </div>
                <div class="pt-8">
                    <button id="continue_button" class="flex min-w-[84px] w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em] transition-opacity hover:opacity-90">
                        <span class="truncate">הבנתי, נמשיך</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Help Popup -->
    <div id="help_popup" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 transition-opacity duration-300 animate-fadeIn hidden" dir="rtl">
        <div class="relative w-full max-w-2xl bg-black/20 border border-white/10 text-white rounded-xl shadow-2xl backdrop-blur-2xl transition-transform duration-300 animate-scaleIn p-8 help-popup-artistic">
            <button id="close_help" class="absolute top-4 left-4 flex h-8 w-8 items-center justify-center rounded-full bg-white/10 text-white/70 hover:bg-white/20 hover:text-white transition-colors z-10">
                <img src="close.png" alt="Close" class="h-5 w-5" />
            </button>
            <div class="flex flex-col gap-2">
                <h1 class="text-3xl font-bold tracking-tight text-white/95">מדריך למצבי חיפוש</h1>
                <p class="text-white/70">מדריך זה מסביר את מצבי החיפוש השונים הזמינים, השימוש בהם ומגבלותיהם.</p>
            </div>
            <div class="mt-8 flex flex-col gap-4">
                <!-- Accordion Item 1 -->
                <details class="help-accordion-item" open="">
                    <summary class="help-accordion-summary">
                        <div class="flex items-center gap-4">
                            <img src="stars.png" alt="Stars" class="h-5 w-5"/>
                            <h3 class="text-lg font-semibold text-white/90">חיפוש סמנטי</h3>
                        </div>
                        <div class="transform transition-transform duration-300 group-open:rotate-180">
                            <span class="material-symbols-outlined text-white/60">expand_more</span>
                        </div>
                    </summary>
                    <div class="help-accordion-content">
                        <p>חיפוש סמנטי מבין את המשמעות וההקשר של השאילתה שלך, ומחזיר תוצאות רלוונטיות מבחינה רעיונית, גם אם אינן מכילות את מילות המפתח המדויקות. מצוין לשאלות מורכבות ורעיונות מופשטים.</p>
                        <div class="space-y-1">
                            <h4 class="font-semibold text-white/70">מגבלות:</h4>
                            <ul class="list-disc pr-5 space-y-1 text-sm text-white/70">
                                <li>עשוי להיות איטי יותר מחיפוש מילות מפתח.</li>
                                <li>פחות יעיל למציאת מונחים או קודים ספציפיים.</li>
                            </ul>
                        </div>
                    </div>
                </details>
                
                <!-- Accordion Item 2 -->
                <details class="help-accordion-item">
                    <summary class="help-accordion-summary">
                        <div class="flex items-center gap-4">
                            <img src="key.png" alt="Key" class="h-5 w-5"/>
                            <h3 class="text-lg font-semibold text-white/90">חיפוש מילות מפתח</h3>
                        </div>
                        <div class="transform transition-transform duration-300 group-open:rotate-180">
                            <span class="material-symbols-outlined text-white/60">expand_more</span>
                        </div>
                    </summary>
                    <div class="help-accordion-content">
                        <p>מצב זה מחפש התאמות מדויקות של המילים שסיפקת במסמכים. אידיאלי למציאת שמות, מזהים, או ציטוטים ספציפיים במהירות וביעילות.</p>
                        <div class="space-y-1">
                            <h4 class="font-semibold text-white/70">מגבלות:</h4>
                            <ul class="list-disc pr-5 space-y-1 text-sm text-white/70">
                                <li>לא ימצא מילים נרדפות או מושגים קשורים.</li>
                                <li>דורש לדעת את המונחים המדויקים לחיפוש.</li>
                            </ul>
                        </div>
                    </div>
                </details>
                
                <!-- Accordion Item 3 -->
                <details class="help-accordion-item">
                    <summary class="help-accordion-summary">
                        <div class="flex items-center gap-4">
                            <img src="merge_type.png" alt="Merge" class="h-5 w-5"/>
                            <h3 class="text-lg font-semibold text-white/90">חיפוש היברידי</h3>
                        </div>
                        <div class="transform transition-transform duration-300 group-open:rotate-180">
                            <span class="material-symbols-outlined text-white/60">expand_more</span>
                        </div>
                    </summary>
                    <div class="help-accordion-content">
                        <p>החיפוש ההיברידי משלב את העוצמה של חיפוש סמנטי עם הדיוק של חיפוש מילות מפתח. הוא מספק את התוצאות הרלוונטיות ביותר על ידי איזון בין הבנת הקשר לבין התאמות מדויקות.</p>
                        <div class="space-y-1">
                            <h4 class="font-semibold text-white/70">מגבלות:</h4>
                            <ul class="list-disc pr-5 space-y-1 text-sm text-white/70">
                                <li>תוצאות החיפוש עשויות להיות מורכבות יותר להבנה.</li>
                            </ul>
                        </div>
                    </div>
                </details>
            </div>
        </div>
    </div>

    <!-- Config Popup -->
    <div id="config_popup" class="popup-backdrop hidden">
        <div class="help-popup-content animate-scale-in">
            <button id="close_config" class="absolute top-4 left-4 flex h-8 w-8 items-center justify-center rounded-full bg-[#2a2a2a] text-[#888888] hover:bg-[#3a3a3a] hover:text-white transition-colors">
                <img src="close.png" alt="Close" class="h-5 w-5" />
            </button>
            <div class="flex flex-col gap-2">
                <h1 class="text-3xl font-bold tracking-tight">Configuration</h1>
                <p class="text-[#888888]">Configure your API endpoint and other settings.</p>
            </div>
            <div class="mt-8 flex flex-col gap-6">
                <!-- API Endpoint Configuration -->
                <div class="space-y-4">
                    <div class="flex items-center gap-4">
                        <img src="api.png" alt="API" class="h-5 w-5"/>
                        <h3 class="text-lg font-semibold">API Endpoint</h3>
                    </div>
                    <div class="space-y-2">
                        <label for="api_endpoint" class="block text-sm font-medium text-[#E5E5E5]">Server URL</label>
                        <input 
                            type="url" 
                            id="api_endpoint" 
                            placeholder="http://localhost:8000" 
                            class="w-full px-4 py-3 rounded-lg bg-[#1e1e1e] text-white placeholder:text-[#888888] border border-[#2a2a2a] focus:border-primary/80 focus:shadow-[0_0_0_3px_rgba(19,127,236,0.3)] focus:outline-none transition-all"
                        >
                        <p class="text-sm text-[#888888]">Enter the full URL of your API server (e.g., http://localhost:8000)</p>
                    </div>
                </div>
                
                <!-- Connection Status -->
                <div class="space-y-4">
                    <div class="flex items-center gap-4">
                        <img src="wifi.png" alt="Wifi" class="h-5 w-5"/>
                        <h3 class="text-lg font-semibold">Connection Status</h3>
                    </div>
                    <div id="connection_status" class="flex items-center gap-2 p-3 rounded-lg bg-[#1e1e1e] border border-[#2a2a2a]">
                        <div id="status_indicator" class="w-3 h-3 rounded-full bg-yellow-500"></div>
                        <span id="status_text" class="text-sm text-[#E5E5E5]">Not tested</span>
                    </div>
                    <button id="test_connection" class="w-full px-4 py-2 rounded-lg bg-primary text-white font-medium hover:bg-primary/90 transition-colors">
                        Test Connection
                    </button>
                </div>
                
                <!-- Save Button -->
                <div class="pt-4">
                    <button id="save_config" class="w-full px-4 py-3 rounded-lg bg-primary text-white font-bold hover:bg-primary/90 transition-colors">
                        Save Configuration
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Page Preview Popup -->
    <div id="page_popup" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-black/50 transition-opacity duration-300" dir="rtl">
        <div class="relative w-full max-w-3xl bg-black/20 border border-white/10 text-white rounded-xl shadow-2xl backdrop-blur-2xl transition-transform duration-300 p-6 help-popup-artistic">
            <button id="close_page_popup" class="absolute top-4 left-4 flex h-8 w-8 items-center justify-center rounded-full bg-white/10 text-white/70 hover:bg-white/20 hover:text-white transition-colors z-10">
                <img src="close.png" alt="Close" class="h-5 w-5" />
            </button>
            <div class="flex flex-col gap-4">
                <div class="flex items-center justify-between gap-4">
                    <div class="flex items-center gap-3">
                        <span class="material-symbols-outlined text-sapphire">description</span>
                        <div class="flex flex-col">
                            <div id="page_file_name" class="text-white font-semibold">Document</div>
                            <div class="text-white/60 text-sm"><span id="page_keyword"></span> • <span id="page_meta"></span></div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="text-white/70 text-xs select-all" id="page_doc_id">doc-id</div>
                        <button id="copy_doc_id" class="px-3 py-1 rounded-md bg-[#222222] text-white/80 text-xs border border-white/10 hover:bg-[#262626]">Copy peregraph ID</button>
                    </div>
                </div>
                <div class="rounded-lg bg-[#171717] border border-white/10 p-4 max-h-[50vh] overflow-auto" id="page_preview">
                    <pre id="page_preview_text" class="whitespace-pre-wrap text-white/90 text-sm"></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js').catch(function(){});
            });
        }
    </script>
</body>
</html>
